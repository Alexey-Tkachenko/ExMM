# DSL выбора полей при перехвате

При вызове обработчика чтения или записи регистра функция-обработчик получает указатель на регистровый файл и смещение поля в этом файле. Ручная обработка смещений - слишком утомительное занятие, поэтому реализован типизированный мини-язык для преобразования полей в смещения в структуре регистров.
В методах `HookRead` и `HookWrite` может быть вызван метод `SwitchField`, принимающий те же аргумент, что сами функции-перехватчики, который возвращает объект-селектор полей `FieldHelper<T>`. Селектор имеет небольшой набор методов, которые могут вызываться цепочкой:
1. `Case(field, callback)` - вызовет функцию обратного вызова, если смещение при обращении соответствует полю в первом аргументе (принимается `volatile`-указатель на поле).
Функция обратного вызова принимает `volatile`-ссылку на значение поля, переданного первым аргументом (внутри `HookWrite` можно принимать аргумент по значению).
1. `Inside(field, callback)` - вызовет функцию обратного вызова, если смещение при обращении находится внутри поля, указатель на которое был передан первым аргументом.
Функция обратного вызова принимает селектор полей вложенной структуры типа `FieldHelper<F>` (шаблонный тип - тип поля), который позволяет выполнить обход поля вглубину. Аргумент можно принимать как `auto`.
1. `CaseArray(arrayField, callback)` - вызовет функцию обратного вызова, если смещение при обращении соответствует полю-массиву, указатель на который был передан первым аргументом.
Функция обратного вызова принимает первым аргументом индекс в массиве элемента, в которое попало указанное смещение, и само значение элемента массива по `volatile`-ссылке или по значению.
1. `InsideArray(arrayField, callback)` - вызовет функцию обратного вызова, если смещение при обращении находится внутри поля-массива, указатель на который был передан первым аргументом.
Функция обратного вызова получает индекс массива и селектор полей вложенной структуры типа `FieldHelper<F>` (шаблонный тип - тип элемента массива),который позволяет выполнить обход поля вглубину. Второй аргумент можно принимать как `auto`.
1. `Else(callback)` - вызывается если ни одна из функций обратного вызова не была вызвана. Этот метод не возвращает `void`, и после него продолжить цепочку нельзя - он должен завершать цепочку регистрации обратных вызовов.
Функция обратного вызова принимает смещение в байтах относительно начала структуры.
